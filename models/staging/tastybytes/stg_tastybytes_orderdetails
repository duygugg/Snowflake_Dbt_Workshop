with source as (

    select * from {{ source('tastybytes', 'order_detail') }}

),

renamed as (

    select
    
        {{ dbt_utils.surrogate_key(
            ['ORDER_DETAIL_ID', 
            'ORDER_ID']) }}
                as order_item_key,
        ORDER_ID as order_key,
        menu_item_id,
        TRUCK_ID ,
        line_number,
        quantity,
        unit_price
        case 
            when order_item_discount_amount is not null then price - (order_item_discount_amount) 
            else price
        end  as net_price,
        (order_item_discount_amount/price)*100 as discount_percentage

    from source

)

select * from renamed